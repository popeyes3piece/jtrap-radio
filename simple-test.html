<!DOCTYPE html>
<html>
<head>
    <title>AzuraCast Requests API Test</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .song-item { border: 1px solid #ccc; padding: 10px; margin: 5px 0; background: #f9f9f9; }
        .song-title { font-weight: bold; color: #000; }
        .song-artist { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <h1>AzuraCast Requests API Test</h1>
    <p>This will test the requests endpoints to see what data structure we get.</p>
    
    <div id="results"></div>
    
    <script>
        async function testRequestsAPI() {
            const results = document.getElementById('results');
            results.innerHTML = '<p class="info">Testing requests endpoints...</p>';
            
            // Try multiple endpoints
            const endpoints = [
                '/api/requests',
                '/api/station/random/requests',
                '/api/station/1/requests',
                '/api/station/jtrap_radio/requests'
            ];
            
            for (const endpoint of endpoints) {
                const url = `https://10.0.0.36${endpoint}`;
                results.innerHTML += `<h3>Testing: <a href="${url}" target="_blank">${url}</a></h3>`;
                
                try {
                    const response = await fetch(url, {
                        headers: { 'Accept': 'application/json' },
                        redirect: 'follow'
                    });
                    
                    results.innerHTML += `<p>Status: ${response.status} ${response.statusText}</p>`;
                    results.innerHTML += `<p>Final URL: ${response.url}</p>`;
                    
                    if (response.ok) {
                        const data = await response.json();
                        results.innerHTML += `<p class="success">✅ SUCCESS!</p>`;
                        
                        // Show data structure
                        results.innerHTML += `<h4>Data Type: ${Array.isArray(data) ? 'Array' : 'Object'}</h4>`;
                        results.innerHTML += `<h4>Length/Keys: ${Array.isArray(data) ? data.length : Object.keys(data || {}).length}</h4>`;
                        
                        if (Array.isArray(data) && data.length > 0) {
                            results.innerHTML += `<h4>First Item Structure:</h4>`;
                            results.innerHTML += `<pre>${JSON.stringify(data[0], null, 2)}</pre>`;
                            
                            results.innerHTML += `<h4>Sample Songs (first 3):</h4>`;
                            data.slice(0, 3).forEach((song, index) => {
                                results.innerHTML += `
                                    <div class="song-item">
                                        <div class="song-title">Song ${index + 1}: ${song.title || song.name || song.song_title || song.track_title || 'NO TITLE'}</div>
                                        <div class="song-artist">Artist: ${song.artist || song.artist_name || song.artist_title || song.performer || 'NO ARTIST'}</div>
                                        <div>ID: ${song.request_id || song.id || song.song_id || song.track_id || 'NO ID'}</div>
                                        <div>All keys: ${Object.keys(song).join(', ')}</div>
                                    </div>
                                `;
                            });
                        } else if (data && typeof data === 'object') {
                            results.innerHTML += `<h4>Object Structure:</h4>`;
                            results.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                        }
                        
                        results.innerHTML += `<hr>`;
                        break; // Stop on first success
                    } else {
                        results.innerHTML += `<p class="error">❌ Failed: ${response.status} ${response.statusText}</p>`;
                    }
                } catch (error) {
                    results.innerHTML += `<p class="error">❌ Error: ${error.message}</p>`;
                }
                
                results.innerHTML += `<br>`;
            }
        }
        
        // Run test when page loads
        testRequestsAPI();
    </script>
</body>
</html>
